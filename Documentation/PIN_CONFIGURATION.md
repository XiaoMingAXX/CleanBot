# CleanBot 引脚配置说明

本文档说明CleanBot项目中所有硬件引脚的配置和使用。

## 引脚分配总览

### GPIO引脚定义

所有引脚定义在 `Core/Inc/main.h` 中，由STM32CubeMX自动生成。

## 详细引脚配置

### LED控制引脚

| LED | 引脚 | 端口 | 功能 |
|-----|------|------|------|
| LED1 | PIN_12 | GPIOC | 状态指示LED1 |
| LED2 | PIN_1 | GPIOG | 状态指示LED2 |
| LED3 | PIN_2 | GPIOE | 状态指示LED3 |
| LED4 | PIN_14 | GPIOF | 状态指示LED4 |

**配置**: 推挽输出，上拉，低速

### 蜂鸣器控制引脚

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| BUZZER | PIN_6 | GPIOF | 蜂鸣器PWM控制 |

**配置**: 复用推挽输出，PWM模式

### 轮电机控制引脚

#### 左轮电机 (Motor1)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_7 | GPIOB | 左轮电机PWM |
| DIR | PIN_6 | GPIOB | 左轮电机方向控制 |

**配置**: 
- PWM: 复用推挽输出，PWM模式
- DIR: 推挽输出，上拉

#### 右轮电机 (Motor2)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_15 | GPIOD | 右轮电机PWM |
| DIR | PIN_14 | GPIOD | 右轮电机方向控制 |

**配置**: 
- PWM: 复用推挽输出，PWM模式
- DIR: 推挽输出，上拉

### 边刷电机控制引脚

#### 左边刷电机 (CleanMotor1)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_8 | GPIOC | 左边刷电机PWM |

**配置**: 复用推挽输出，PWM模式

#### 右边刷电机 (CleanMotor2)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_9 | GPIOC | 右边刷电机PWM |

**配置**: 复用推挽输出，PWM模式

### 吸尘电机控制引脚

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_7 | GPIOC | 吸尘电机PWM |

**配置**: 复用推挽输出，PWM模式

### 水箱增压电机控制引脚

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| PWM | PIN_6 | GPIOC | 水箱增压电机PWM |

**配置**: 复用推挽输出，PWM模式

### 编码器引脚

#### 左轮编码器 (TIM2)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| A相 | - | - | TIM2_CH1 |
| B相 | - | - | TIM2_CH2 |

**配置**: 编码器模式，上拉输入

#### 右轮编码器 (TIM3)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| A相 | - | - | TIM3_CH1 |
| B相 | - | - | TIM3_CH2 |

**配置**: 编码器模式，上拉输入

#### 风机编码器 (TIM4)

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| A相 | - | - | TIM4_CH1 |
| B相 | - | - | TIM4_CH2 |

**配置**: 编码器模式，上拉输入

### 红外传感器引脚

| 传感器 | 引脚 | 端口 | 功能 | 中断 |
|--------|------|------|------|------|
| 左侧 | PIN_12 | GPIOF | 左侧红外接收 | EXTI15_10 |
| 右侧 | PIN_3 | GPIOE | 右侧红外接收 | EXTI3 |
| 左前 | PIN_9 | GPIOD | 左前红外接收 | EXTI9_5 |
| 右前 | PIN_2 | GPIOA | 右前红外接收 | EXTI2 |

**配置**: 上拉输入，外部中断模式

### 光电门引脚

| 传感器 | 引脚 | 端口 | 功能 | 中断 |
|--------|------|------|------|------|
| 左侧 | PIN_15 | GPIOA | 左侧光电门 | EXTI15_10 |
| 右侧 | PIN_4 | GPIOE | 右侧光电门 | EXTI4 |

**配置**: 上拉输入，外部中断模式

### USB引脚

| 信号 | 引脚 | 端口 | 功能 |
|------|------|------|------|
| USB_DM | PA11 | GPIOA | USB数据负 |
| USB_DP | PA12 | GPIOA | USB数据正 |
| USB_VBUS | PA9 | GPIOA | USB电源检测 |

**配置**: 复用推挽输出，USB模式

## 定时器配置

### PWM定时器

| 定时器 | 通道 | 功能 | 频率 |
|--------|------|------|------|
| TIM1 | CH1 | 左轮电机PWM | 20kHz |
| TIM1 | CH2 | 右轮电机PWM | 20kHz |
| TIM8 | CH1 | 左边刷电机PWM | 20kHz |
| TIM8 | CH2 | 右边刷电机PWM | 20kHz |
| TIM9 | CH1 | 吸尘电机PWM | 20kHz |
| TIM10 | CH1 | 水箱增压电机PWM | 20kHz |
| TIM11 | CH1 | 蜂鸣器PWM | 可变 |

### 编码器定时器

| 定时器 | 功能 | 模式 |
|--------|------|------|
| TIM2 | 左轮编码器 | 编码器模式 |
| TIM3 | 右轮编码器 | 编码器模式 |
| TIM4 | 风机编码器 | 编码器模式 |

## 中断配置

### 外部中断优先级

| 中断源 | 优先级 | 说明 |
|--------|--------|------|
| EXTI2 | 7 | 右前红外传感器 |
| EXTI3 | 7 | 右侧红外传感器 |
| EXTI4 | 7 | 右侧光电门 |
| EXTI9_5 | 7 | 左前红外传感器、按钮 |
| EXTI15_10 | 7 | 左侧红外传感器、左侧光电门 |

### 定时器中断优先级

| 中断源 | 优先级 | 说明 |
|--------|--------|------|
| TIM2 | 5 | 左轮编码器 |
| TIM3 | 5 | 右轮编码器 |
| TIM4 | 5 | 风机编码器 |

### USB中断优先级

| 中断源 | 优先级 | 说明 |
|--------|--------|------|
| OTG_FS | 6 | USB通信 |

## 注意事项

1. **PWM频率**: 建议设置为20kHz，避免可听噪声
2. **编码器模式**: 使用定时器的编码器模式，自动处理A/B相
3. **中断优先级**: 编码器中断优先级较高，确保精确计数
4. **USB配置**: 需要正确配置USB描述符和端点
5. **GPIO速度**: 根据实际需求选择GPIO速度等级

## 引脚复用

某些引脚可能被多个功能复用，需要根据实际硬件设计进行配置。在STM32CubeMX中配置时，需要注意：

1. 检查引脚冲突
2. 合理分配定时器资源
3. 考虑引脚驱动能力

## 硬件连接检查清单

- [ ] 所有LED引脚正确连接
- [ ] 蜂鸣器PWM引脚正确连接
- [ ] 所有电机PWM和方向引脚正确连接
- [ ] 编码器A/B相正确连接
- [ ] 红外传感器引脚正确连接
- [ ] 光电门引脚正确连接
- [ ] USB引脚正确连接
- [ ] 电源和地线正确连接

## 调试建议

1. 使用示波器检查PWM信号
2. 使用逻辑分析仪检查编码器信号
3. 使用万用表检查GPIO电平
4. 使用串口/USB输出调试信息

